---
layout: 'post'
title: å‡çº§åˆ° webpack2
tags: fe webpack2 webpack
date: 2017-01-25
draft: false
---

è¿‘æœŸåœ¨å…¬å¸æŠŠ PC-WWW é¡¹ç›®ä»ä¹‹å‰æ¯”è¾ƒå¤æ‚çš„è„šæœ¬æ”¹æˆäº†webpackï¼Œéšåå› ä¸ºçœ‹åˆ°webpack2å‘å¸ƒäº†æ­£å¼ç‰ˆæœ¬åˆå‡çº§åˆ°äº† webpack2ã€‚æ•ˆæœéå¸¸å¥½ã€‚

## ä¸ºä»€ä¹ˆä½¿ç”¨ webpack

webpack æ˜¯ä¸€æ¬¾éå¸¸éå¸¸å¼ºå¤§çš„å‰ç«¯èµ„æºå¤„ç†å·¥å…·ï¼Œå¯ä»¥æŠŠæ‰€æœ‰å‰ç«¯éœ€è¦çš„èµ„æºç»Ÿä¸€å¤„ç†ã€‚æ¯”å¦‚jsæ–‡ä»¶ï¼Œcssæ–‡ä»¶ï¼Œç”šè‡³å›¾ç‰‡ï¼Œå­—ä½“æ–‡ä»¶ï¼Œhtmlæ–‡ä»¶ã€‚é€šè¿‡ä¸€ä¸ªä¸ªç‹¬ç‰¹çš„ loader æ¥å¯¹æ–‡ä»¶è¿›è¡Œä¸€äº›å¤„ç†ã€‚

æ¯”å¦‚å¯ä»¥é€šè¿‡ babel-loader å¯¹ä½¿ç”¨ES2015+çš„jsä»£ç è¿›è¡Œç¼–è¯‘å¤„ç†ï¼Œæ”¹æˆæµè§ˆå™¨å¯ä»¥ç†è§£çš„es5ç”šè‡³æ˜¯es3çš„è¯­æ³•ã€‚é€šè¿‡css-loaderå¯¹cssæ–‡ä»¶è¿›è¡Œä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚hashæ‰classåï¼Œé€šè¿‡stylus-loaderå°†stylusè¯­æ³•çš„æ–‡ä»¶è½¬æˆcssè¯­æ³•ï¼Œé€šè¿‡file-loaderå¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†ï¼Œç­‰ç­‰ç­‰ç­‰ã€‚

è¿˜æœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½ä¹ˆï¼Ÿå½“ç„¶æ˜¯æœ‰çš„ã€‚

å¯ä»¥é€šè¿‡é…ç½®publicPathå°†é™æ€èµ„æºæ–‡ä»¶ç›´æ¥æ”¹æˆcdnè·¯å¾„ã€‚é€šè¿‡htmlæ’ä»¶å°†èµ„æºæ–‡ä»¶ç›´æ¥å†™å…¥htmlã€‚ä»…ä»…é€šè¿‡ä¸€ä¸ª`-p`å‚æ•°å®ç°ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ã€‚é€šè¿‡`react-hot-loader`å®ç°çƒ­é‡è½½ã€‚é€šè¿‡postcss-loaderå¯¹cssæ–‡ä»¶è¿›è¡Œæ·»åŠ å‰ç¼€ï¼Œå˜é‡æ”¯æŒç­‰å¤„ç†ã€‚

webpack ä½¿å¾—å‰ç«¯å¼€å‘å˜å¾—æ›´åŠ å·¥ç¨‹åŒ–ï¼Œæ›´åŠ åˆç†ï¼Œæ›´åŠ èˆ’é€‚ï¼Œæ›´å…·æœ‰çµæ´»æ€§ã€‚

## ä¸ºä»€ä¹ˆå‡çº§ webpack2

æ—¢ç„¶ webpack1 å·²ç»å¾ˆå¥½ç”¨äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è´¹å¤§åŠ›æ°”å‡çº§ webpack2ï¼Œè€Œä¸”å‘ä¹Ÿæ¯”è¾ƒå¤šã€‚

ä¸»è¦æ˜¯å› ä¸ºä¸¤ä¸ªåŸå› ï¼š

* æœåŠ¡ç«¯æ¸²æŸ“

å¦‚æœå“ªä½è¯»è€…åšè¿‡æœåŠ¡ç«¯æ¸²æŸ“å°±ä¼šçŸ¥é“ï¼Œè·¯ç”±çš„å¼‚æ­¥åŠ è½½éœ€è¦ç”¨åˆ° require.ensureï¼Œä½†æ˜¯è¿™åœ¨æœåŠ¡ç«¯æ²¡æœ‰ï¼Œæ‰€ä»¥éœ€è¦ polyfillï¼Œå¾ˆéº»çƒ¦ã€‚è€Œå‡çº§åˆ° webpack2 çš„è¯å°±ä¸éœ€è¦å¤„ç†è¿™äº›ï¼Œç”¨è‡ªå¸¦çš„ `import` å³å¯ã€‚

* æ€§èƒ½

webpack2 ç”¨äº† Treeshakingã€‚å¯ä»¥åˆ†æå¼•ç”¨æ–‡ä»¶ï¼Œè¿›è€Œä¸åŠ è½½ä¸éœ€è¦çš„æ–‡ä»¶ï¼Œæœ‰æ•ˆå‡å°‘æ–‡ä»¶çš„å¤§å°ï¼Œå‡å°‘ä¸€å®šçš„åŠ è½½æ—¶é—´ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

å°±æœ€åçš„ç»“æœæ¥çœ‹ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“æ­£å¸¸ï¼Œè€Œå‰ç«¯jsä»£ç æ–‡ä»¶æ˜æ˜¾å‡å°‘ï¼Œæ•ˆæœå¾ˆå¥½ã€‚

## ç»“æ„

æ•´ä¸ªç»“æ„åˆ†ä¸ºè¿™ä¹ˆå‡ ä¸ªéƒ¨åˆ†ï¼š

ä¸€ä¸ªåŸºç¡€é…ç½®æ¨¡å—ï¼Œç”¨ä»¥æŠŠé€šç”¨çš„é…ç½®æŠ½ç¦»å‡ºæ¥ã€‚

ä¸€ä¸ªå¼€å‘é…ç½®é¡¹ï¼Œä¸€ä¸ªæœåŠ¡ç«¯é…ç½®é¡¹ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„é…ç½®è„šæœ¬

å› ä¸ºyarnæ‹¥æœ‰æ›´å¿«çš„å®‰è£…é€Ÿåº¦ï¼Œæ¯”è¾ƒæ¨èyarnï¼Œå¦‚æœä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹[è¿™ç¯‡æ–‡ç« ](https://annatarhe.github.io/2016/10/12/translate-chinese-yarn-a-new-package-manager-for-javascript.html)äº†è§£ä¸€ä¸‹

```sh
$ yarn add webpack webpack-dev-server\
    react-hot-loader@next extract-text-webpack-plugin@2.0.0-beta.5\
    babel-loader babel-preset-es2015 babel-preset-react\
    babel-preset-stage-0 style-loader css-loader\
    autopprefixer postcss-loader postcss-modules-values
```

## dev

ç”±äºä½¿ç”¨äº†react-hot-loaderï¼Œéœ€è¦åœ¨entryåŠ ä¸Šä¸€äº›é…ç½®

react-hot-loader æ˜¯ç”¨æ¥çƒ­åŠ è½½ç»„ä»¶çš„ï¼Œç®€å•æ¥è¯´ä¿®æ”¹ç»„ä»¶ä»¥åå¯ä»¥è‡ªåŠ¨åœ¨å±€éƒ¨åˆ·æ–°ï¼Œè€Œä¸ç”¨æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚å¯ä»¥å‡å°‘ç­‰å¾…æ—¶é—´ï¼Œä½¿å¾—æ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰ä¹‹å‰æ•´é¡µåˆ·æ–°é‚£æ ·ç—›è‹¦ã€‚

```js
entry: [
    'react-hot-loader/patch',
    'webpack-dev-server/client?http://localhost:8080',
    'webpack/hot/only-dev-server',
    './your/entry.js'
],
```

è‡³äºoutputçš„é…ç½®ä¹Ÿæ˜¯æ¯”è¾ƒæ­£å¸¸çš„ï¼Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯å°½é‡ä½¿ç”¨ `path.resolve` æ¥è§£æè·¯å¾„ã€‚
output çš„ä½œç”¨æ˜¯å‘Šè¯‰ webpack åº”è¯¥å°†æ–‡ä»¶è¾“å‡ºåœ¨å“ªé‡Œï¼Œä»¥ä»€ä¹ˆæ ·çš„åå­—è¾“å‡º

```js
output: {
    path: path.resolve(__dirname, '..', 'dist'),
    filename: '[name].bundle.js',
    publicPath: '/',
    chunkFilename: '[name]-[id].chunk.js'
},
```

module æ˜¯ä¸»è¦çš„æ–‡ä»¶å¤„ç†è§„åˆ™ï¼Œéœ€è¦å¤„ç†çš„æ–‡ä»¶åœ¨è¿™é‡Œå®šä¹‰è§„åˆ™ï¼š.cssæ–‡ä»¶éœ€è¦ç”¨css-loaderæ¥å¤„ç†è¿™æ ·çš„è§„åˆ™ã€‚æ‰€ä»¥ module çš„åœ°æ–¹é…ç½®é¡¹å˜äº†å¾ˆå¤šï¼Œéœ€è¦ä¸€äº›è°ƒæ•´ï¼š

è¿™ä¸ªmoduleå› ä¸ºdevå’Œserverä¸¤ä¸ªéƒ¨åˆ†éƒ½è¦ç”¨ï¼Œæ‰€ä»¥æŠŠå®ƒå†™æˆäº†ä¸€ä¸ªfuncæ”¾åœ¨baseä¸­ã€‚è‡³äºåšæˆå‡½æ•°è€Œä¸æ˜¯é…ç½®é¡¹æ˜¯å› ä¸ºcsséœ€è¦åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™éœ€è¦åˆ‡æ¢æˆå¦ä¸€å¥—é…ç½®ã€‚

```js
function getModules(cssLocals = false) {
  return {
    rules: [
      {
        test: /\.jsx?$/,
        use: ['babel-loader'],
        exclude: [
          path.resolve(__dirname, '..', 'node_modules')
        ]
      },
      {
        test: /\.css$/,
        exclude: [
          path.resolve(__dirname, '..', 'node_modules'),
          path.resolve(__dirname, '..', 'common', 'assets')
        ],
        loader: getCssLoader(cssLocals)
      },
      {
        test: /\.css$/,
        include: [
          path.resolve(__dirname, '..', 'node_modules'),
          path.resolve(__dirname, '..', 'common', 'assets')
        ],
        loader: ExtractTextPlugin.extract({
          fallbackLoader: 'style-loader',
          loader: 'css-loader'
        })
      },
      {
        test: /\.(eot|woff|woff2|ttf|svg|png|jpg|gif)$/,
        use: [{
          loader: 'url-loader',
          options: {
            limit: 500,
            name: '[name]-[hash].[ext]'
          }
        }]
      }
    ]
  }
}
```

getCssLoader çš„ä½œç”¨æ˜¯æ ¹æ®ä¸åŒçš„å‚æ•°ï¼Œè¿”å›ä¸åŒçš„cssé…ç½®æ–‡ä»¶ï¼šåœ¨æœåŠ¡ç«¯æ¸²æŸ“é˜¶æ®µï¼Œåªç”¨ç”Ÿæˆåå­—å³å¯ï¼Œæ— é¡»å°†å†…å®¹è¾“å‡ºï¼Œè€Œåœ¨æµè§ˆå™¨ä¸­ä¸ä»…éœ€è¦ç”Ÿæˆå¯¹åº”çš„åå­—ï¼Œè€Œä¸”ä¹Ÿéœ€è¦å°†æ–‡ä»¶è¾“å‡ºï¼Œä½¿å¾—æ ·å¼å¯è§ã€‚

```js
function getCssLoader(locals = false) {
  const originCssLoaders = [{
    loader: `css-loader${locals ? '/locals' : ''}`,
    options: {
      modules: true,
      minimize: true,
      camelCase: true,
      importLoaders: 1,
      localIdentName: '[name]_[local]-[hash:base64:4]',
      sourceMap: true
    }
  }, {
    loader: 'postcss-loader'
  }]

  return locals ? originCssLoaders : ExtractTextPlugin.extract({
    fallbackLoader: 'style-loader',
    loader: [
      'css-loader?modules=true&camelCase=true&importLoaders=1' +
      '&localIdentName=[name]_[local]-[hash:base64:4]&sourceMap=true' +
      (process.env.NODE_ENV === 'production' ? '&minimize=true' : ''),
      'postcss-loader'
    ]
  })
}
```

å› ä¸ºä¸Šé¢å®šä¹‰äº† getModulesï¼Œ æ‰€ä»¥ç°åœ¨åªè¦è°ƒç”¨å°±å¯ä»¥å¾—åˆ°ç›¸åº”çš„moduleé…ç½®äº†ï¼Œè¿™æ ·webpackå°±çŸ¥é“å¦‚ä½•å¤„ç†å¯¹åº”çš„æ–‡ä»¶ï¼š

```js
module: getModules(false)
```

plugins æ˜¯ä¸€äº›æ’ä»¶çš„é…ç½®, è€Œæ–°ç‰ˆå–æ¶ˆäº†å‡ ä¸ªé…ç½®ï¼Œè¿™äº›æ’ä»¶ç›®å‰æ„Ÿè§‰æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼š

å…¶ä½œç”¨åˆ†åˆ«æ˜¯çƒ­æ›´æ–°æ’ä»¶ï¼Œé…ç½®é¡¹æ’ä»¶ï¼Œç›¸åŒæ–‡ä»¶æ‰“åŒ…æ’ä»¶ï¼Œç¯å¢ƒå˜é‡å®šä¹‰æ’ä»¶ï¼ŒHTMLå¤„ç†æ’ä»¶ï¼Œcssæ ·å¼æå–æ’ä»¶

```js
  plugins: [
    new webpack.HotModuleReplacementPlugin(),
    new webpack.LoaderOptionsPlugin({
      debug: true
    }),
    new webpack.optimize.CommonsChunkPlugin({
      name: 'vendor',
      filename: '[name].[contenthash:8].js',
      minChunks: Infinity
    }),
    new webpack.DefinePlugin({
      __DEV__: process.env.NODE_ENV !== 'production' ? 'true' : 'false',
      NODE_ENV: process.env.NODE_ENV,
      'process.env': {
        NODE_ENV: JSON.stringify(process.env.NODE_ENV || 'development_local')
      }
    }),
    new HtmlWebpackPlugin({
      filename: 'index.html',
      inject: 'body',
      template: path.resolve(__dirname, '..', 'your', 'view.html')
    }),
    new ExtractTextPlugin({
      filename: '[name].[contenthash:8].css',
      allChunks: true
    })
  ],
```

è¿˜æœ‰resolveé…ç½®ï¼Œä¹Ÿå°±æ˜¯å°‘å†™ç‚¹å„¿åç¼€åï¼š

```js
resolve: {
    extensions: ['.js', '.jsx']
}
```

devServeræ˜¯åœ¨å¼€å‘é˜¶æ®µç”¨åˆ°çš„ä¸€äº›é…ç½®ï¼Œä¹Ÿéœ€è¦è¿›è¡Œä¸€éƒ¨åˆ†è®¾ç½®ï¼š

```js
devServer: {
    hot: true,
    contentBase: path.resolve(__dirname, '..', 'dist'),
    historyApiFallback: true,
    proxy: [
        proxyThis('/apiV1'),
        proxyThis('/apiV2')
    ]
}
```

è¿™é‡Œçš„proxyä½œç”¨æ˜¯å¯¹è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œè½¬å‘è‡³å¦å¤–çš„æœåŠ¡å™¨ã€‚åœ¨è¿™ä¸ªé…ç½®ä¸­é€šç”¨çš„åšæ³•æ˜¯æŠŠè¯·æ±‚è½¬åˆ°mock serverä¸Šã€‚å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œé…ç½®ï¼Œå¦‚æœæœ‰å¤šä¸ªé…ç½®é¡¹æ¨èå†™æˆä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼š

```js
function proxyThis(where) {
  return {
    path: where,
    debug: true,
    target: 'http://your.dev.api.server',
    secure: false,
    changeOrigin: true,
    header: {
      cookie: 'some cookie'
    }
  }
}
```

åˆ°è¿™é‡Œï¼Œæ•´ä¸ªå¼€å‘ç¯å¢ƒçš„é…ç½®å°±å®Œæˆäº†ã€‚å¯ä»¥é€šè¿‡å†™å…¥npm scriptæ¥è¿›è¡Œè°ƒç”¨ï¼Œè¿™æ ·å°±åˆå¯ä»¥å°‘æ‰“å‡ ä¸ªå­—ï¼š

```json
"scripts": {
    "dev": "cross-env NODE_ENV=development_local webpack-dev-server\
    --colors --config ./build/webpack.config.dev.js"
}
```

## server

é¡¹ç›®ä¸­ç”¨åˆ°äº†server renderï¼Œæ‰€ä»¥è¿˜éœ€è¦å¯¹æœåŠ¡ç«¯ä»£ç è¿›è¡Œæ‰“åŒ…ã€‚æ‰“åŒ…è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†ä¸ºå®¢æˆ·ç«¯æ‰“åŒ…å’ŒæœåŠ¡ç«¯æ‰“åŒ…ã€‚ä¹‹æ‰€ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†æ˜¯å› ä¸ºä¸¤ä¸ªéƒ¨åˆ†éœ€æ±‚ä¸åŒï¼Œå®¢æˆ·ç«¯éœ€è¦ä»£ç å‹ç¼©ï¼Œéœ€è¦cssæ–‡ä»¶è¾“å‡ºï¼Œéœ€è¦æŠŠå¤–éƒ¨æ–‡ä»¶æ‰“åŒ…å‡ºæ¥ã€‚è€ŒæœåŠ¡ä¾§ä»£ç åˆ™ä¸åŒï¼Œå®Œå…¨æ‹’ç»ä»£ç å‹ç¼©ï¼Œcssä¸éœ€è¦æ–‡ä»¶è¾“å‡ºï¼Œå¤–éƒ¨nodeæ¨¡å—ç›´æ¥å¼•ç”¨ï¼Œè€Œæ— éœ€æ‰“åŒ…ã€‚

åœ¨å®¢æˆ·ç«¯çš„æ‰“åŒ…é…ç½®å¦‚ä¸‹ï¼š

```js
const clientConfig = {
  entry: {
    bundle: path.resolve(__dirname, '..', 'your', 'client', 'index.js'),
    vendor // æ ¹æ®ä½ è‡ªå·±çš„é¡¹ç›®é…ç½®vendor
  },
  output: {
    path: path.resolve(__dirname, '..', 'your', 'client/dist'),
    filename: '[name].[chunkhash:8].js',
    publicPath: process.env.NODE_ENV !== 'production' ?
      `/` : `${your.cdn.server}/`,
    chunkFilename: '[id].[chunkhash:8].js'
  },
  module: getModules(false),
  resolve,
  plugins: [
    new webpack.optimize.OccurrenceOrderPlugin(),
    new webpack.optimize.CommonsChunkPlugin({
      names: ['vendor', 'manifest'],
      filename: '[name].[chunkhash:8].js'
    }),
    new webpack.DefinePlugin({
      NODE_ENV: process.env.NODE_ENV
    }),
    new HtmlWebpackPlugin({
      filename: 'index.ejs',
      template: path.resolve(__dirname, '..', 'your', 'client', 'pc.ejs'),
      inject: true,
      includes: getViewShouldBeIncluded()
    }),
    new ExtractTextPlugin({
      filename: '[name].[contenthash:8].css',
      allChunks: true
    }),
    new webpack.optimize.UglifyJsPlugin({
      compress: {
        warnings: false
      },
      comments: false
    })
  ]
}
```

åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™ç”¨äº†`ejs`ä½œä¸ºæ¨¡æ¿ï¼Œé‡Œé¢ç”¨äº†ä¸€äº›è¯­æ³•ï¼Œæ‰€ä»¥éœ€è¦includeï¼Œè¿™é‡Œä¸ç»™å‡ºå…·ä½“çš„å®ç°äº†ï¼Œä½œç”¨å°±æ˜¯æŠŠä¸€äº›éœ€è¦includeçš„æ–‡ä»¶åŠ è½½è¿›æ¥ã€‚

æœåŠ¡ç«¯çš„æ‰“åŒ…æ¯”è¾ƒç±»ä¼¼ï¼Œä¸è¿‡è¦åŠ ä¸Štargetå’Œä¸€äº›outputçš„æ”¹å˜, è¿˜æœ‰ä¸€å®šè¦æ³¨æ„ä¸è¦æ‰“åŒ…åˆ° public ç›®å½•ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸èƒ½è®©ç”¨æˆ·è®¿é—®å¾—åˆ°çš„ï¼š

```js
const serverConfig = {
  devtool: 'source-map',
  entry: path.resolve(__dirname, '..', 'your', 'server', 'entry.js'),
  output: {
    path: path.resolve(__dirname, '..', 'your', 'server', 'output'),
    filename: 'index.js',
    publicPath: process.env.NODE_ENV !== 'production' ?
    `/` : `${your.cdn.server}/`,
    chunkFilename: '[id].[chunkhash:8].js',
    libraryTarget: 'commonjs2'
  },
  target: 'node',
  node: {
    __dirname: true,
    __filename: true
  },
  module: getModules(true),
  externals: getExternals(),
  resolve,
  plugins: [
    new webpack.DefinePlugin({ 'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV) })
  ]
}
```

è¿™é‡Œçš„getExternalsæ˜¯æŠŠæ•´ä¸ª`node_modules`ä½œä¸ºexternalsï¼š

```js
function getExternals() {
  return fs.readdirSync(path.resolve(__dirname, '..', 'node_modules'))
    .filter(filename => !filename.includes('.bin'))
    .reduce((externals, filename) => {
      externals[filename] = `commonjs ${filename}`
      return externals
    }, {})
}
```

æœ€åçš„å¯¼å‡ºéœ€è¦å¯¼å‡ºä¸€ä¸ªæ•°ç»„ï¼Œwebpackæ˜¯å¯ä»¥æ¥å—çš„ï¼š

```js
module.exports = [clientConfig, serverConfig]
```

åŒæ ·å†™å…¥åˆ°npm scriptsä¸­

```json
"scripts": {
    "compile": "cross-env NODE_ENV=production webpack\
    --colors --config ./build/webpack.config.server.js && node ./build/postCompile.js"
}
```

## æ³¨æ„äº‹é¡¹

* .babelrc

å…¶å®ä¹‹å‰æ¼æ‰äº†ä¸€ä¸ªå¾ˆé‡è¦çš„é…ç½®ï¼š.babelrc

æ ¹æ®å®˜ç½‘è¯´æ˜¯è¦æŠŠ es2015 è®¾ç½®æˆè¿™æ ·ï¼Œå› ä¸ºwebpackä¼šè‡ªåŠ¨è¯†åˆ«å¹¶å¤„ç†ï¼š

```json
{ "presets" : [[ "es2015", {"modules": false}], "react"]}
```

ç»è¿‡æˆ‘äº²èº«å®è·µï¼Œæ²¡é”™ï¼Œå®ƒæ˜¯éª—ä½ çš„ã€‚

è¿™ä¸ªç‚¹è¯´å‡ºæ¥å…¨æ˜¯æ³ªï¼šæœ‰æ—¶å€™è¦åŠ ä¸Š`modules: false`ï¼Œè€Œæœ‰æ—¶å€™ä¸éœ€è¦ã€‚æˆ‘åœ¨macä¸‹æ˜¯éœ€è¦åŠ ï¼Œè€ŒUbuntuåˆä¸èƒ½åŠ ã€‚ç‰ˆæœ¬æ›´æ–°ä¾æ—§å¦‚æ­¤ã€‚

æ‰€ä»¥è¿™ä¸ªåœ°æ–¹ï¼Œä½ å¯èƒ½éœ€è¦é çŒœäº†ï¼ŒåŠ `modules: false`è¯•è¯•ï¼Œå¦‚æœæŠ¥é”™ç±»ä¼¼äº`exports is not defined`è¿™æ ·çš„é”™è¯¯å°±å»æ‰å†è¯•è¯•ã€‚

å˜æˆç±»ä¼¼äºè¿™æ ·çš„å°±å¯ä»¥äº†ï¼š

```json
{
  "presets": [
    "es2015",
    "stage-0",
    "react"
  ],
  "plugins": [
    "transform-runtime",
    "react-hot-loader/babel",
  ]
}
```

* ExtractTextPlugin

è¿™ä¸ªæ’ä»¶ä¹Ÿæ”¹äº†é…ç½®ï¼Œéœ€è¦ä¼ å…¥å¯¹è±¡ã€‚è¿˜æœ‰ï¼Œæ³¨æ„ä¸è¦æ‹¼é”™å•è¯ ğŸ˜‘

* import

webpack2æ¨èä½¿ç”¨`import()`å¼‚æ­¥åŠ è½½è„šæœ¬ï¼Œç„¶è€Œç”¨çš„æ—¶å€™**æœ‰æ—¶å€™**ä¼šæŠ¥é”™ç±»ä¼¼äº`import and export may only appear at the top level`è¿™æ ·çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š

```shell
$ yarn add -D babel-plugin-syntax-dynamic-import
```

ç„¶ååŠ å…¥å¦‚ä¸‹å†…å®¹åˆ°.babelrcä¸­ï¼š
```json
{ "plugins": ["syntax-dynamic-import"] }
```

* loader-utils

å¦‚æœä½ ç¢°åˆ°äº†ç±»ä¼¼äºè¿™æ ·çš„æŠ¥é”™ï¼š`parseQuery should get a string as first argument`ï¼Œæ­å–œä½ ï¼Œä½ å¯èƒ½åˆè¸©å‘äº†ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯æ›´æ–°ä¸€ä¸‹`loader-utils`ï¼Œè¿™ä¸ªé—®é¢˜è´¼å‘ï¼Œæˆ‘åœ¨Ubuntuä¸Šæ²¡ç¢°åˆ°ï¼Œ@å¯è¯š åœ¨Macä¸Šç¢°åˆ°äº†ã€‚

è§£å†³æ–¹æ³•æ˜¯æ›´æ–°ä¸€ä¸‹è¿™ä¸ªåŒ…

```shell
$ yarn upgrade loader-utils
```

* postcss

å¦‚æœä½ è¿˜ç”¨äº†ä¸€å¤§å †postcssçš„æ’ä»¶ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦æ›´æ–°åˆ°ä¸€ä¸ªæ–°çš„`postcss.config.js`ä¸­äº†ã€‚

ç±»ä¼¼äºè¿™æ ·çš„ï¼š

```js
module.exports = {
    plugins: [
        require('postcss-modules-values'),
        require('autoprefixer')
    ]
}
```

* React-router.match

æœåŠ¡ç«¯æ¸²æŸ“éœ€è¦ç”¨åˆ°matchï¼Œæ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œéƒ½æ˜¯å½“åšåŒæ­¥å‡½æ•°ä½¿ç”¨çš„ï¼Œç„¶è€Œå®é™…ä¸Šæ˜¯å¼‚æ­¥çš„. æ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ã€‚ä¸€å®šè¦æ³¨æ„ï¼ä¸€å®šè¦æ³¨æ„ï¼

å…³äºæœåŠ¡ç«¯æ¸²æŸ“è¯·å‚è€ƒè¿™ç¯‡æ–‡ç« çš„å®ç°ï¼š[æ•™ä½ å¦‚ä½•æ­å»ºä¸€ä¸ªè¶…å®Œç¾çš„æœåŠ¡ç«¯æ¸²æŸ“å¼€å‘ç¯å¢ƒ](http://www.jianshu.com/p/0ecd727107bb)

## å¦‚æœä½ è¿˜æœ‰é—®é¢˜

å¦‚æœä½ è¿˜æœ‰é—®é¢˜ï¼Œå…¬å¸çš„é…ç½®æˆ‘ä¸èƒ½å¼€æ”¾å‡ºæ¥ï¼Œä½†æ˜¯æ¨èä½ å»çœ‹çœ‹æˆ‘å¦ä¸€ä¸ªé¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œå°‘äº†æœåŠ¡ç«¯æ¸²æŸ“çš„éƒ¨åˆ†ï¼Œä½†æ˜¯æœåŠ¡ç«¯æ¸²æŸ“æ‰€éœ€è¦æ³¨æ„çš„åœ°æ–¹åœ¨è¿™ç¯‡æ–‡ç« ä¸­æœ‰äº†ä¸€äº›è¯´æ˜ã€‚åº”è¯¥ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜äº†çš„ã€‚

[AnnatarHe-graduation-project/exam-online-fe](https://github.com/AnnatarHe-graduation-project/exam-online-fe)

## babel-polyfill

è¿™æ˜¯ä¸€ä¸ªbabelç”¨äºå…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨çš„åŒ…ï¼Œé‡Œé¢åˆå¼•ç”¨äº†[core.js](https://github.com/zloirock/core-js)ï¼ŒåŒ…æ‹¬äº†å¾ˆå¤šes6,7å®ç°çš„ä¸€äº›æ–¹æ³•çš„å®ç°ï¼Œè¿™ä¸ªåŒ…æŒºå¤§çš„ã€‚å¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ç”¨åˆ°å…¶ä¸­çš„ä¸€äº›å‡½æ•°ï¼Œå¯ä»¥é€‰æ‹©éƒ¨åˆ†åŠ è½½ã€‚

è¯¦ç»†è¯·çœ‹[è¿™é‡Œ](https://github.com/zloirock/core-js/blob/master/shim.js), é€‰æ‹©é¡¹ç›®ä¸­ç”¨åˆ°çš„å‡½æ•°åŠ è½½å¥½äº†ã€‚

## ç»“è®º

å¦‚æœä¸åœ¨æ„webpack2çš„æ— é™å¤§å‘æ–‡æ¡£ï¼Œå…¶å®å‡çº§ä¹‹åçš„æ‰“åŒ…æ•ˆæœæ¯”è¾ƒå¥½çš„ã€‚

æˆ‘ä»¬é¡¹ç›®åŸæ¥çš„ä¸‰ä¸ªä¸»è¦æ–‡ä»¶åˆ†åˆ«æ˜¯(æœªgzipå‹ç¼©, æœªå»é™¤babel-polyfill)ï¼š

vendor: 283kb

bundle: 147kb

css: 18.5kb

ç»è¿‡webpack2çš„æ‰“åŒ…é™æˆäº†ï¼š

vendor: 216kb

bundle: 177kb

css: 21.9kb

æ€»å…±é™ä½äº†37kb.

æ•ˆæœè¿˜æ˜¯æœ‰çš„ã€‚

æ¨èä½ ä¹Ÿå¿«å‡(cai)çº§(keng)å§~ğŸ˜Š

